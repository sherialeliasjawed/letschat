(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{208:function(e,t,a){},209:function(e,t,a){"use strict";a.r(t);var n=a(1),s=a.n(n),r=a(70),o=a.n(r),c=(a(84),a(71)),m=a(72),l=a(77),i=a(73),u=a(3),d=a(78),h=a(27),p=a(74),g=a(26),v=a.n(g),E=a(75),f=a.n(E);function b(e){var t=this;(function(e){var t=this.state,a=t.currentUser,n=t.rooms,s="".concat(a.id,"_").concat(e),r=n.filter(function(t){if(t.customData&&t.customData.isDirectMessage){var n=[a.id,e],s=t.customData.userIds;if(n.sort().join("")===s.sort().join(""))return{room:t}}return!1});return r.length>0?Promise.resolve(r[0]):a.createRoom({name:"".concat(s),private:!0,addUserIds:["".concat(e)],customData:{isDirectMessage:!0,userIds:[a.id,e]}})}).call(this,e).then(function(e){N.call(t,e.id)})}function N(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"20648717",a=this.state.currentUser;return this.setState({messages:[]}),a.subscribeToRoom({roomId:"".concat(t),messageLimit:100,hooks:{onMessage:function(t){e.setState({messages:[].concat(Object(h.a)(e.state.messages),[t])})},onPresenceChanged:function(){var t=e.state.currentRoom;e.setState({roomUsers:t.users.sort(function(e){return"online"===e.presence.state?-1:1})})}}}).then(function(t){var n=t.customData&&t.customData.isDirectMessage?t.customData.userIds.filter(function(e){return e!==a.id})[0]:t.name;e.setState({currentRoom:t,roomUsers:t.users,rooms:a.rooms,roomName:n})}).catch(console.error)}var w=function(e){var t=e.userId,a=e.handleInput,n=e.connectToChatkit;return s.a.createElement("div",{className:"dialog-container"},s.a.createElement("div",{className:"dialog"},s.a.createElement("form",{className:"dialog-form",onSubmit:n},s.a.createElement("label",{className:"username-label",htmlFor:"username"},"Please enter your username and password: ",s.a.createElement("br",null),"(Please provide just a username for now.)"),s.a.createElement("input",{id:"username",className:"username-input",autoFocus:!0,type:"text",name:"userId",value:t,onChange:a,placeholder:"Username"}),s.a.createElement("input",{type:"password",className:"password-input",placeholder:"Password (Coming soon..)",disabled:!0}),s.a.createElement("button",{type:"submit",className:"submit-btn"},"Login"))))},I=function(e){var t=e.rooms,a=e.currentRoom,n=e.connectToRoom,r=e.currentUser,o=t.map(function(e){var t=e.isPrivate?s.a.createElement("img",{src:"/img/lock-closed-padlock-silhouette.svg",alt:"Private",class:"private-img"}):s.a.createElement("img",{src:"/img/square-shape-shadow.svg",alt:"Public",class:"public-img"}),o=e.id===a.id?"active":"";return s.a.createElement("li",{className:o,key:e.id,onClick:function(){return n(e.id)}},s.a.createElement("span",{className:"room-icon"},t),e.customData&&e.customData.isDirectMessage?s.a.createElement("span",{className:"room-name"},e.customData.userIds.filter(function(e){return e!==r.id})[0]):s.a.createElement("span",{className:"room-name"},e.name))});return s.a.createElement("div",{className:"rooms"},s.a.createElement("ul",{className:"chat-rooms"},o))},R=a(76),D=function(e){return e.messages.map(function(e){var t=Object(R.format)(new Date("".concat(e.updatedAt)),"HH:mm");return s.a.createElement("li",{className:"message",key:e.id},s.a.createElement("div",null,s.a.createElement("span",{className:"user-id"},e.senderId),s.a.createElement("span",null,e.text)),s.a.createElement("span",{className:"message-time"},t))})},M=function(e){var t=e.newMessage,a=e.handleInput,n=e.sendMessage;return s.a.createElement("form",{onSubmit:n,className:"message-form"},s.a.createElement("input",{value:t,type:"text",name:"newMessage",className:"message-input",placeholder:"Type something here..",onChange:a}))},U=function(e){var t=e.roomUsers,a=e.currentUser,n=e.sendDM,r=t.map(function(e){return s.a.createElement("li",{className:"room-member",key:e.id},s.a.createElement("div",null,s.a.createElement("span",{className:"presence ".concat(e.presence.state)}),s.a.createElement("span",null,e.name)),a.id!==e.id?s.a.createElement("button",{onClick:function(){return n(e.id)},title:"Sent ".concat(e.name," a direct message"),className:"send-dm"},"+"):null)});return s.a.createElement("div",{className:"room-users"},s.a.createElement("span",{className:"room-users"},"Users in this room:"),s.a.createElement("ul",null,r))},j=function(e){var t=e.newRoom,a=e.createRoom,n=e.handleInput;return s.a.createElement("div",{className:"create-room"},s.a.createElement("form",{className:"create-room-form",onSubmit:a},s.a.createElement("input",{name:"newRoom",type:"text",value:t,onChange:n,placeholder:"Create new room",className:"create-room-input"}),s.a.createElement("button",{type:"submit",className:"create-room-btn"},"+")))},k=(a(206),a(207),a(208),function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(l.a)(this,Object(i.a)(t).call(this))).state={userId:"",showLogin:!0,isLoading:!1,currentUser:null,currentRoom:null,rooms:[],roomUsers:[],newRoom:"",roomName:null,messages:[],newMessage:""},e.handleInput=function(e){var t=e.target,a=t.value,n=t.name;this.setState(Object(p.a)({},n,a))}.bind(Object(u.a)(e)),e.connectToChatkit=function(e){var t=this;e.preventDefault();var a=this.state.userId;null!==a&&""!==a.trim()?f.a.post("/users",{userId:a}).then(function(){var e=new v.a.TokenProvider({url:"/authenticate"});return new v.a.ChatManager({instanceLocator:"v1:us1:15a4e1ad-85e5-4f75-8403-1ca55ac4eebe",userId:a,tokenProvider:e}).connect({onAddedToRoom:function(e){var a=t.state.rooms;t.setState({rooms:[].concat(Object(h.a)(a),[e])})}}).then(function(e){t.setState({currentUser:e,showLogin:!1,rooms:e.rooms},function(){return N.call(t)})})}).catch(console.error):alert("Invalid userId")}.bind(Object(u.a)(e)),e.connectToRoom=N.bind(Object(u.a)(e)),e.sendMessage=function(e){e.preventDefault();var t=this.state,a=t.newMessage,n=t.currentUser,s=t.currentRoom;""!==a.trim()&&(n.sendMessage({text:a,roomId:"".concat(s.id)}),this.setState({newMessage:""}))}.bind(Object(u.a)(e)),e.sendDM=b.bind(Object(u.a)(e)),e.createRoom=function(e){e.preventDefault();var t=this.state,a=t.currentUser,n=t.newRoom;n.length>0&&""!==n.trim()&&(a.createRoom({name:n,private:!1,customData:{isDirectMessage:!1,userIds:[a.id]}}).catch(function(e){console.log("Error creating room ".concat(e))}),this.setState({newRoom:""}))}.bind(Object(u.a)(e)),e}return Object(d.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.state,t=e.userId,a=e.showLogin,n=e.rooms,r=e.currentUser,o=e.currentRoom,c=e.roomUsers,m=e.newRoom,l=e.roomName,i=e.messages,u=e.newMessage;return s.a.createElement("div",{className:"App"},s.a.createElement("aside",{className:"sidebar left-sidebar"},r?s.a.createElement("div",{className:"user-profile"},s.a.createElement("div",{className:"avatar"},s.a.createElement("img",{src:"/img/user.svg",alt:"No avatar"})),s.a.createElement("div",{className:"username"},r.name),s.a.createElement("div",{className:"user-id"},"@".concat(r.id))):null,o?s.a.createElement(U,{currentUser:r,roomUsers:c,sendDM:this.sendDM}):null,a?s.a.createElement(w,{userId:t,handleInput:this.handleInput,connectToChatkit:this.connectToChatkit}):null),s.a.createElement("section",{className:"chat-screen"},s.a.createElement("header",{className:"chat-header"},o?s.a.createElement("h3",null,l," ",s.a.createElement("span",{style:{color:"#0dabae"}},"(",o.users.length," users)")):null),s.a.createElement("ul",{className:"chat-messages"},s.a.createElement(D,{messages:i})),s.a.createElement("footer",{className:"chat-footer"},s.a.createElement(M,{newMessage:u,handleInput:this.handleInput,sendMessage:this.sendMessage}))),s.a.createElement("aside",{className:"sidebar right-sidebar"},s.a.createElement("h1",null,s.a.createElement("span",{style:{color:"#98a0a9"}},"lets"),"chat."),s.a.createElement("div",{className:"right-sidebar-header"},r?s.a.createElement(j,{newRoom:m,createRoom:this.createRoom,handleInput:this.handleInput}):null),o?s.a.createElement(I,{rooms:n,currentRoom:o,connectToRoom:this.connectToRoom,currentUser:r}):null))}}]),t}(n.Component));o.a.render(s.a.createElement(k,null),document.getElementById("root"))},79:function(e,t,a){e.exports=a(209)},84:function(e,t,a){}},[[79,1,2]]]);
//# sourceMappingURL=main.975336a1.chunk.js.map